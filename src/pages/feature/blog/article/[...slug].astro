---
import "@fontsource/jetbrains-mono";

import {
    ProductBlogLayout,
    ProductBlogsBodyLayout,
} from "@modules/blogs-module";
import {
    BaseGlobalStyle,
    BaseMaterialTheme,
    ImportJetbrainsMonoStyle,
    ImportMaterialSymbols,
    PageMetaInfo,
} from "@modules/shared-module";

import { ProductRootHtmlLayout } from "@modules/shared-module";
import { getCollection, type CollectionEntry } from "astro:content";
import { ViewTransitions } from "astro:transitions";

export async function getStaticPaths() {
    /**
     * Please complete the code here.
     * Please confirm that there is an mdx file in the src/content/blogs/* folder.
     *
     * This project provides `blog` folder by default.
     */
    const posts = await getCollection("blog");

    /**
     * Copied.
     * @link https://docs.astro.build/en/guides/markdown-content/#example-dynamic-page-routing
     */
    return posts.map((post) => ({
        params: {
            slug: post.slug,
        },
        props: {
            blog: post,
        },
    }));
}
interface Props {
    blog: CollectionEntry<"blog">;
}

const { blog } = Astro.props;
const { Content } = await blog.render();
---

<ProductRootHtmlLayout>
    <PageMetaInfo
        slot="head"
        author="bre97"
        description={blog.data.description}
        title={`${blog.data.headline} - Bre97's Blog`}
        iconHref="/glare-labs-page-icon.svg"
        keywords={blog.data.tags.join()}
        language="en-US"
        url={`https://glare-labs.uk/feature/blog/article/${blog.slug}/`}
        imageUrl="https://media.glare-labs.uk/blog-logo.png"
        imageAlt="Bre97's Blog"
        robots="index, follow"
        ogType="website"
    />

    <ImportJetbrainsMonoStyle slot="head-after" />
    <BaseMaterialTheme slot="head-after" />
    <BaseGlobalStyle slot="head-after" />
    <ImportMaterialSymbols slot="head-after" />

    <ViewTransitions slot="head-after" />

    <ProductBlogsBodyLayout>
        <ProductBlogLayout
            markdownString={blog.body}
            collection={blog.data.collection}
            creationTime={blog.data.creationTime}
            description={blog.data.description}
            headline={blog.data.headline}
            tags={blog.data.tags}
        >
            <Content />
        </ProductBlogLayout>
    </ProductBlogsBodyLayout>
</ProductRootHtmlLayout>

<style>
    @layer default-family {
        html,
        body {
            font-family:
                "Jetbrains mono",
                "Roboto",
                "Noto",
                "Noto Sans",
                ui-sans-serif,
                system-ui,
                -apple-system,
                BlinkMacSystemFont,
                "Segoe UI",
                "Helvetica Neue",
                Arial,
                sans-serif,
                "Apple Color Emoji",
                "Segoe UI Emoji",
                "Segoe UI Symbol",
                "Noto Color Emoji";
        }
    }
</style>
